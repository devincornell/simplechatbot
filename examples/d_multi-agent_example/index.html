
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://devincornell.github.io/simplechatbot/examples/d_multi-agent_example/">
      
      
        <link rel="prev" href="../c-model_specific_chatbots/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.39">
    
    
      
        <title>Multi-agent Examples - simplechatbot</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#multi-agent-examples" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="simplechatbot" class="md-header__button md-logo" aria-label="simplechatbot" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            simplechatbot
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Multi-agent Examples
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/devincornell/simplechatbot" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    devincornell/simplechatbot
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="simplechatbot" class="md-nav__button md-logo" aria-label="simplechatbot" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    simplechatbot
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/devincornell/simplechatbot" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    devincornell/simplechatbot
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../a-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../b-tool_calling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tool Calling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../c-model_specific_chatbots/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model-specific ChatBots
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Multi-agent Examples
  </span>
  

      </a>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="multi-agent-examples">Multi-agent Examples</h1>
<p>In this example I show an example of an agent that writes a story using a series of steps.</p>
<ol>
<li>The user provides an idea for their story.</li>
<li>The <code>Outline Bot</code> generates an outline for the story including section titles and descriptions.</li>
<li>The first section content is created by the <code>Story Bot</code> from section title/description and the overall story description.</li>
<li>The <code>Summary Bot</code> creates a summary of the newly generated chapter.</li>
<li>The section summary is passed to the <code>Story Bot</code> along with section title/description to generate the next section.</li>
<li>All sections follow steps 3-5.
...</li>
<li>The sections are combined into a full story.</li>
</ol>
<p><img alt="Story bot design diagram" src="https://storage.googleapis.com/public_data_09324832787/story_bot_design.svg" /></p>
<pre><code class="language-python">import sys
sys.path.append('..')

import simplechatbot
from simplechatbot.openai import OpenAIChatBot
</code></pre>
<p>First I create a new chatbot from OpenAI using the API stored in the keychain file.</p>
<p>I also create a new function <code>stream_it</code> that prints the result from the LLM as it is received and returns the full result of the LLM call.</p>
<pre><code class="language-python">keychain = simplechatbot.APIKeyChain.from_json_file('../keys.json')
base_chatbot = OpenAIChatBot.new(
    model_name = 'gpt-4o-mini', 
    api_key=keychain['openai'],
)

def stream_it(chatbot: simplechatbot.ChatBot, msg: str | None = None) -&gt; simplechatbot.ChatResult:
    stream = chatbot.chat_stream(msg, add_to_history=False)
    for chunk in stream:
        print(chunk.content, end='', flush=True)
    return stream.collect()
</code></pre>
<p>Next we need to direct the LLM to create an outline for the story. I do this by creating a system prompt describing the task of creating an outline and a pydantic class to direct the LLM on how to structure its response. This is important because the output of the outline bot will be used for generating chapters.</p>
<pre><code class="language-python">import pydantic

from typing import Optional

#from pydantic import BaseModel, Field
import pydantic

class StoryOutline(pydantic.BaseModel):
    &quot;&quot;&quot;Outline of the story.&quot;&quot;&quot;

    story_topic: str = pydantic.Field(description=&quot;The topic of the story.&quot;)

    part1_title: str = pydantic.Field(description=&quot;Title of Part 1 of the story.&quot;)
    part1_description: str = pydantic.Field(description=&quot;Longer description of part 1.&quot;)

    part2_title: str = pydantic.Field(description=&quot;Title of Part 2 of the story.&quot;)
    part2_description: str = pydantic.Field(description=&quot;Longer description of part 2.&quot;)

    part3_title: str = pydantic.Field(description=&quot;Title of Part 3 of the story.&quot;)
    part3_description: str = pydantic.Field(description=&quot;Longer description of part 3.&quot;)

    def outline_str(self) -&gt; str:
        return f'topic: {self.story_topic}\n\n{self.part1_title}: {self.part1_description}\n\n{self.part2_title}: {self.part2_description}\n\n{self.part3_title}: {self.part3_description}'


system_prompt = '''
The user will provide you a description of a story, and you must create a chapter outline with titles and brief descriptions.
Each section should contain a title and a brief description of what happens in that section.
The sections should all be part of a single narrative ark, but each section should have a complete beginning, middle, and end.
'''
outline_bot = base_chatbot.structbot_from_model(
    output_structure=StoryOutline,
    system_prompt=system_prompt,
)

q = f'Write an outline for a story about two friends who met when they were young and then lost touch. They meet again as adults and have to navigate their new relationship.'
outline: StoryOutline = outline_bot._model.with_structured_output(StoryOutline).invoke(q)
print(outline.outline_str())
</code></pre>
<pre><code>topic: Rekindling Friendship

The Innocent Beginning: Two children, Emma and Jack, meet at a summer camp and quickly form a deep and meaningful friendship. They spend their days exploring the woods, sharing secrets, and dreaming about the future. However, as summer ends, their paths diverge, and they lose touch as they go back to their separate lives.

Years Apart: As the years pass, Emma and Jack grow up in different cities, each facing their own challenges. Emma pursues a career in art, while Jack becomes a successful entrepreneur. Despite their busy lives, they occasionally think about each other, reminiscing about their childhood friendship but never reaching out.

Unexpected Reunion: Fate brings Emma and Jack back together at a mutual friend's wedding. Their initial joy is tinged with awkwardness as they realize how much they have changed. They spend the weekend reconnecting, sharing their life stories, and navigating the complexities of their new adult relationship, ultimately deciding whether to rekindle their friendship or go their separate ways once again.
</code></pre>
<p>Next we create a bot that will generate the actual chapter content based on information generated in the outline and a summary of the previous chapter (if one exists).</p>
<pre><code class="language-python">chapter_bot_system_prompt = f'''
You are designed to write a single chapter of a larger story based on the following information:

+ Overall story topic: The topic of the full story.
+ Chapter title: The title of the section you are writing.
+ Chapter description: A longer description of what happens in the section.
+ (optional) previous chapter summary: A summary of the previous chapter.

Your responses should only include text that is part of the story. Do not include the chapter title 
or any other information that is not part of the story itself.
'''

def chapter_bot_prompt(
    story_topic: str,
    chapter_title: str,
    chapter_description: str,
    previous_chapter_summary: Optional[str] = None,
) -&gt; str:
    return f'''
    General story topic: &quot;{story_topic}&quot;

    Section title: &quot;{chapter_title}&quot;

    Description: &quot;{chapter_description}&quot;

    Previous chapter summary: &quot;{previous_chapter_summary if previous_chapter_summary is not None else 'No previous chapter - this is the first!'}&quot;
    '''

chapter_bot = base_chatbot.empty().clone(
    system_prompt=chapter_bot_system_prompt,
)
</code></pre>
<p>Now we actually create the chatper using the prompt.</p>
<pre><code class="language-python">cb1 = base_chatbot.empty().clone(
    system_prompt=system_prompt,
)
prompt = chapter_bot_prompt(outline.story_topic, outline.part1_title, outline.part1_description)
chapter1 = stream_it(chapter_bot, prompt)
</code></pre>
<pre><code>The sun dipped low on the horizon, casting a warm golden hue over Maplewood Park, where the gentle rustle of leaves danced with the laughter of children playing nearby. It was a place that once brimmed with memories for Emma and Jake, two childhood friends who had drifted apart over the years, consumed by the tides of life.

Emma sat on a weathered wooden bench, her sketchbook resting on her lap, the pages blank but for a few light pencil lines that hinted at her longing to capture the beauty around her. She had come to the park to find inspiration, but what she found instead was a wave of nostalgia that threatened to engulf her. She remembered the countless afternoons spent here, sketching the trees and laughing until their sides hurt.

As she drew absentmindedly, a familiar voice broke through her reverie. “Is that you, Emma?”

Startled, she looked up to find Jake standing a few paces away, his hair tousled and a bright smile lighting up his face. He had changed since the last time she saw him—taller, with a more confident demeanor, but his eyes still sparkled with the same mischief she remembered.

“Jake! I didn’t expect to see you here,” Emma replied, her heart racing as she closed her sketchbook.

“I could say the same,” he chuckled, taking a seat beside her. “I’ve been wandering around, trying to find a place to clear my head. It seems like we both chose the same spot.”

A moment of silence hung in the air, both of them unsure of how to bridge the gap that time had created. Emma glanced at her sketchbook, then at Jake, contemplating whether to bring up the past or keep it buried.

“So, what are you working on?” Jake asked, breaking the tension.

“Oh, just some doodles. I haven’t done much lately,” she admitted, feeling a little self-conscious. “It’s been a while since I’ve had the time.”

“I remember you used to spend hours drawing. You always had the best ideas,” he said, genuine admiration in his voice.

Emma smiled, warmth spreading through her. “Yeah, I guess I lost track of it all. Life got busy, you know?”

“Tell me about it. I’ve been swamped with work and…well, everything else,” Jake replied, his gaze drifting to the children playing tag nearby. “But I’ve missed this place. It feels good to be back.”

“Yeah, it does,” Emma agreed, looking around. The park was alive with the sounds of laughter and the smell of fresh grass. It was comforting and familiar, a reminder of simpler times.

“Do you remember that time we tried to build a treehouse?” Jake suddenly exclaimed, laughter bubbling forth. “We thought we could start a business!”

“Of course! We barely got past the first few branches!” Emma chuckled, shaking her head at the memory. “But we had the best summer planning it.”

As they reminisced, the shadows grew longer, and a sense of ease began to settle between them. The laughter flowed more freely now as stories spilled out, each memory acting as a thread, weaving their friendship back together.

“I’ve missed this, you know?” Jake said after a while, his tone turning more serious. “I’ve missed you.”

Emma’s heart skipped a beat. “I’ve missed you too, Jake. I didn’t realize how much until now.”

The park was quieting down, the vibrant colors of the sunset merging into deeper shades of orange and purple. They sat side by side, the weight of unspoken words hanging in the air, yet feeling lighter with each shared story. In that moment, under the vast canvas of the changing sky, Emma realized that perhaps this was the innocent beginning of something new—an opportunity to rekindle their friendship and rediscover the connection that had once been so vivid.

As they stood to leave, Jake turned to her with a hopeful smile. “How about we make a pact to come back here more often? I mean, if you’re up for it.”

“I’d like that,” Emma replied, her heart swelling with anticipation. “Let’s not let life get in the way again.”

With one last glance at the park, they walked away together, laughter mingling with the soft whispers of the evening breeze, the first steps toward rebuilding a friendship that had once felt lost but was now just waiting to be rediscovered.
</code></pre>
<p>Next I create a bot that will summarize a chapter. We will eventually feed this into the creation of chapter 2.</p>
<pre><code class="language-python">summary_bot_system_prompt = f'''
You need to create a summary of the story chapter provided to you by the user.
The summary should include names of relevant characters and capture the story arc of the chapter.
'''
summary_bot = base_chatbot.empty().clone(
    system_prompt=summary_bot_system_prompt,
)
ch1_summary = stream_it(summary_bot, f'Chapter text:\n\n{chapter1.content}')
</code></pre>
<pre><code>In this chapter, the setting is Maplewood Park, where Emma, a passionate artist, seeks inspiration but instead finds herself engulfed in nostalgia. While sitting on a bench, she unexpectedly reunites with her childhood friend, Jake. They share a warm exchange filled with memories of their past, including a humorous recollection of a failed treehouse business they attempted to start in their youth. Their conversation gradually bridges the gap created by years of separation, revealing their mutual longing for the connection they once had.

As they reminisce, both characters express how much they've missed each other, leading to a rekindling of their friendship. The chapter captures the idyllic atmosphere of the park, filled with laughter and memories, and concludes with a hopeful pact between Emma and Jake to return to the park more often, indicating their desire to not let life interfere with their bond again. The chapter beautifully illustrates the themes of nostalgia, reconnection, and the promise of new beginnings in their friendship.
</code></pre>
<p>Now we actually generate the second chapter using the outline and the previous chapter summary.</p>
<pre><code class="language-python">prompt = chapter_bot_prompt(
    outline.story_topic,
    outline.part2_title,
    outline.part2_description,
    ch1_summary.content,
)
chapter2 = stream_it(chapter_bot, prompt)
</code></pre>
<pre><code>The sun dipped lower in the sky, casting a warm golden hue over Maplewood Park. The sounds of laughter and the rustle of leaves created a serene backdrop as Emma and Jake settled into the rhythm of their conversation. Time seemed to melt away as they navigated through a labyrinth of memories, each twist and turn revealing shared secrets and unspoken words.

“I can’t believe we actually thought we could build that treehouse,” Jake chuckled, shaking his head. “I remember us drawing out blueprints on the back of that cereal box.”

Emma laughed, her eyes sparkling with joy. “And we had the audacity to charge the neighborhood kids for entry! I think we made a whole twenty cents before it collapsed.”

“Twenty cents we earned through sheer ambition,” Jake replied, grinning. “I still say it was a brilliant business model.”

Their laughter echoed through the park, and for a moment, it felt as if the years melted away. The weight of their separate lives—filled with college, jobs, and new friendships—lifted, leaving only the essence of who they had been. As they shared stories of their lives since that fateful day, a blend of nostalgia and curiosity filled the air.

“So, what’s the biggest change for you?” Emma asked, tilting her head slightly, a playful smile dancing on her lips.

Jake hesitated for a moment, his expression shifting to one of reflection. “Honestly? I think it’s realizing how much I miss having a true friend. I’ve been so focused on work and moving forward that I forgot how much joy comes from just hanging out with someone who knows you inside and out.”

Emma nodded, her heart swelling with warmth. “I feel the same way. After college, I got caught up in my art and lost touch with everyone. I thought I was happy, but it was like painting in a vacuum—there was no one to share it with.”

As they spoke, the park around them transformed, the vibrant colors of autumn leaves mirroring the rekindling of their friendship. Each shared memory was a brushstroke, painting a picture of who they had once been and who they could become again.

“Do you remember that camping trip we took with our parents?” Jake asked suddenly, a glimmer of mischief in his eyes. “You were convinced you could catch a fish with your bare hands.”

Emma giggled, the memory flooding back. “And I ended up falling into the lake instead! I think I spent the rest of the trip shivering in my sleeping bag.”

“Yeah, and we had to listen to your dad’s terrible campfire songs to keep us warm.”

The laughter that followed was rich and hearty, a sound that felt like home. It was clear that their bond had weathered the storm of years apart. The awkwardness that often accompanies reconnections was absent; instead, it was as if they had simply paused the conversation and picked it up right where they left off.

As the sun began to set, casting long shadows across the park, Emma looked at Jake, her expression serious for a moment. “I don’t want to lose this again, you know? Life has a way of pulling us in different directions.”

Jake nodded, his gaze steady. “Neither do I. Let’s make a promise to meet here regularly. We can’t let the world get in the way of our friendship again.”

A pact was formed in that moment, an unspoken understanding that they would do whatever it took to nurture this connection. They exchanged contact information, both eager to bridge the distance that had grown between them over the years.

As they stood to leave, the park seemed to shimmer with possibility. It was more than just a gathering place; it was a new beginning, a canvas waiting to be filled with memories yet to come. Emma took a deep breath, the crisp air filling her lungs, and smiled at Jake, feeling a renewed sense of hope.

“Until next time,” she said, her heart light.

“Until next time,” Jake echoed, excitement bubbling beneath his calm exterior as they walked together, side by side, ready to face the world anew.
</code></pre>
<p>Create a summary for chapter 2 now.</p>
<pre><code class="language-python">ch2_summary = stream_it(summary_bot, f'Previous chapter text:\n\n{chapter1.content}')
</code></pre>
<pre><code>In this chapter, Emma and Jake, childhood friends who have grown apart, unexpectedly reunite at Maplewood Park, a place filled with their shared memories. Emma, seeking inspiration for her art, finds herself reminiscing about their past when Jake approaches her, sparking a conversation filled with nostalgia and warmth. They share stories of their childhood adventures, including a humorous attempt to build a treehouse, which brings laughter and eases the tension between them.

As they reconnect, both express how much they've missed each other, realizing the significance of their friendship that time had frayed. The atmosphere shifts from a sense of loss to a hopeful promise of rekindling their bond. Jake proposes that they return to the park more often, and Emma eagerly agrees, indicating a desire to not let life interfere with their relationship again. The chapter concludes with them leaving the park together, laughter in the air, symbolizing the first steps toward rebuilding their friendship.
</code></pre>
<p>Use the summary of chapter 2 and outline information to create chapter 3.</p>
<pre><code class="language-python">prompt = chapter_bot_prompt(
    outline.story_topic,
    outline.part2_title,
    outline.part2_description,
    ch2_summary.content,
)
chapter3 = stream_it(chapter_bot, prompt)
</code></pre>
<pre><code>The following weeks felt like a dream to Emma. Each time she returned to Maplewood Park, the familiar sights and sounds wrapped around her like a warm blanket. The vibrant greens of the leaves, the laughter of children echoing in the distance, and the sweet scent of blooming flowers all reminded her of the happiness she had shared with Jake. It was as if time had folded in on itself, allowing them to reclaim a part of their lives that had been set aside for far too long.

Their meetups became a ritual. They would stroll through the park, sharing stories about their lives since they had last seen each other. Jake spoke about his job at the local theater, his passion for acting igniting with every word. Emma found herself captivated, her heart swelling with pride for her friend. She shared her struggles as an artist, the challenges of finding her voice and the pressure to succeed. Jake listened intently, offering encouragement that felt like a lifeline.

One sunny afternoon, as they sat on a bench overlooking the pond, Emma let her fingers dance over her sketchbook. She had begun to fill it with drawings inspired by their time together—each sketch a testament to the rekindled bond they were building. A quick glance at Jake revealed his eyes sparkling with interest, his curiosity piqued by the art that flowed from her heart.

“What are you working on?” he asked, leaning closer.

Emma hesitated, a wave of self-doubt washing over her. “Just some ideas… nothing special,” she replied, trying to downplay her efforts.

Jake tilted his head, his expression earnest. “C’mon, show me. I want to see what you’ve been creating.”

With a deep breath, Emma turned the sketchbook toward him. The first image was of the tree they had attempted to build their treehouse in all those years ago, its branches reaching toward the sky like an invitation to play.

Jake chuckled, nostalgia brightening his face. “I can’t believe we thought we could actually build that thing. We were such dreamers.”

Emma smiled, her heart fluttering at the sight of his amusement. “We still are, aren’t we?”

The conversation flowed easily, punctuated by laughter and the occasional comfortable silence. But beneath the surface, Emma felt a tension building—a fear of losing this newfound connection. Memories of their past, woven with moments of laughter and tears, threatened to unravel at the seams of her heart.

As they watched the sunset paint the sky in hues of orange and pink, Emma took a chance. “You know, I’ve missed this. Not just you, but… us. I didn’t realize how much I needed a friend like you in my life again.”

Jake turned to her, his expression serious. “Me too. I thought those days were gone forever. But now, I can’t imagine not having you around.”

The vulnerability in his voice struck a chord within her, and Emma nodded, her heart racing. “Let’s promise to keep doing this. No matter where life takes us. I don’t want to lose you again.”

He reached for her hand, a simple gesture that spoke volumes. “I promise, Emma. We’ll make this work.”

In that moment, as the sun dipped below the horizon, they sealed their pact with a shared glance that spoke of hope and renewed commitment. The years apart had been filled with silence, but now, in the glow of friendship reignited, they were ready to weave new stories together.

As they walked back through the park, the sounds of the evening wrapped around them, a symphony of cicadas and rustling leaves. Emma felt lighter, as if the weight of the past had been lifted, replaced by the promise of a future filled with laughter, art, and companionship.

And for the first time in years, she felt truly free.
</code></pre>
<p>And now we can review the full text of the book.</p>
<pre><code class="language-python">story = f'''

Overview: {outline.story_topic}

== Chapter 1: {outline.part1_title} ==

{chapter1.content}


== Chapter 2: {outline.part2_title} ==

{chapter2.content}


== Chapter 3: {outline.part3_title} ==

{chapter3.content}

'''

import pprint
pprint.pprint(story)
</code></pre>
<pre><code>('\n'
 '\n'
 'Overview: Rekindling Friendship\n'
 '\n'
 '== Chapter 1: The Innocent Beginning ==\n'
 '\n'
 'The sun dipped low on the horizon, casting a warm golden hue over Maplewood '
 'Park, where the gentle rustle of leaves danced with the laughter of children '
 'playing nearby. It was a place that once brimmed with memories for Emma and '
 'Jake, two childhood friends who had drifted apart over the years, consumed '
 'by the tides of life.\n'
 '\n'
 'Emma sat on a weathered wooden bench, her sketchbook resting on her lap, the '
 'pages blank but for a few light pencil lines that hinted at her longing to '
 'capture the beauty around her. She had come to the park to find inspiration, '
 'but what she found instead was a wave of nostalgia that threatened to engulf '
 'her. She remembered the countless afternoons spent here, sketching the trees '
 'and laughing until their sides hurt.\n'
 '\n'
 'As she drew absentmindedly, a familiar voice broke through her reverie. “Is '
 'that you, Emma?” \n'
 '\n'
 'Startled, she looked up to find Jake standing a few paces away, his hair '
 'tousled and a bright smile lighting up his face. He had changed since the '
 'last time she saw him—taller, with a more confident demeanor, but his eyes '
 'still sparkled with the same mischief she remembered.\n'
 '\n'
 '“Jake! I didn’t expect to see you here,” Emma replied, her heart racing as '
 'she closed her sketchbook. \n'
 '\n'
 '“I could say the same,” he chuckled, taking a seat beside her. “I’ve been '
 'wandering around, trying to find a place to clear my head. It seems like we '
 'both chose the same spot.”\n'
 '\n'
 'A moment of silence hung in the air, both of them unsure of how to bridge '
 'the gap that time had created. Emma glanced at her sketchbook, then at Jake, '
 'contemplating whether to bring up the past or keep it buried. \n'
 '\n'
 '“So, what are you working on?” Jake asked, breaking the tension.\n'
 '\n'
 '“Oh, just some doodles. I haven’t done much lately,” she admitted, feeling a '
 'little self-conscious. “It’s been a while since I’ve had the time.”\n'
 '\n'
 '“I remember you used to spend hours drawing. You always had the best ideas,” '
 'he said, genuine admiration in his voice. \n'
 '\n'
 'Emma smiled, warmth spreading through her. “Yeah, I guess I lost track of it '
 'all. Life got busy, you know?”\n'
 '\n'
 '“Tell me about it. I’ve been swamped with work and…well, everything else,” '
 'Jake replied, his gaze drifting to the children playing tag nearby. “But '
 'I’ve missed this place. It feels good to be back.”\n'
 '\n'
 '“Yeah, it does,” Emma agreed, looking around. The park was alive with the '
 'sounds of laughter and the smell of fresh grass. It was comforting and '
 'familiar, a reminder of simpler times.\n'
 '\n'
 '“Do you remember that time we tried to build a treehouse?” Jake suddenly '
 'exclaimed, laughter bubbling forth. “We thought we could start a business!”\n'
 '\n'
 '“Of course! We barely got past the first few branches!” Emma chuckled, '
 'shaking her head at the memory. “But we had the best summer planning it.”\n'
 '\n'
 'As they reminisced, the shadows grew longer, and a sense of ease began to '
 'settle between them. The laughter flowed more freely now as stories spilled '
 'out, each memory acting as a thread, weaving their friendship back '
 'together.\n'
 '\n'
 '“I’ve missed this, you know?” Jake said after a while, his tone turning more '
 'serious. “I’ve missed you.”\n'
 '\n'
 'Emma’s heart skipped a beat. “I’ve missed you too, Jake. I didn’t realize '
 'how much until now.”\n'
 '\n'
 'The park was quieting down, the vibrant colors of the sunset merging into '
 'deeper shades of orange and purple. They sat side by side, the weight of '
 'unspoken words hanging in the air, yet feeling lighter with each shared '
 'story. In that moment, under the vast canvas of the changing sky, Emma '
 'realized that perhaps this was the innocent beginning of something new—an '
 'opportunity to rekindle their friendship and rediscover the connection that '
 'had once been so vivid.\n'
 '\n'
 'As they stood to leave, Jake turned to her with a hopeful smile. “How about '
 'we make a pact to come back here more often? I mean, if you’re up for it.”\n'
 '\n'
 '“I’d like that,” Emma replied, her heart swelling with anticipation. “Let’s '
 'not let life get in the way again.”\n'
 '\n'
 'With one last glance at the park, they walked away together, laughter '
 'mingling with the soft whispers of the evening breeze, the first steps '
 'toward rebuilding a friendship that had once felt lost but was now just '
 'waiting to be rediscovered.\n'
 '\n'
 '\n'
 '== Chapter 2: Years Apart ==\n'
 '\n'
 'The sun dipped lower in the sky, casting a warm golden hue over Maplewood '
 'Park. The sounds of laughter and the rustle of leaves created a serene '
 'backdrop as Emma and Jake settled into the rhythm of their conversation. '
 'Time seemed to melt away as they navigated through a labyrinth of memories, '
 'each twist and turn revealing shared secrets and unspoken words.\n'
 '\n'
 '“I can’t believe we actually thought we could build that treehouse,” Jake '
 'chuckled, shaking his head. “I remember us drawing out blueprints on the '
 'back of that cereal box.”\n'
 '\n'
 'Emma laughed, her eyes sparkling with joy. “And we had the audacity to '
 'charge the neighborhood kids for entry! I think we made a whole twenty cents '
 'before it collapsed.”\n'
 '\n'
 '“Twenty cents we earned through sheer ambition,” Jake replied, grinning. “I '
 'still say it was a brilliant business model.”\n'
 '\n'
 'Their laughter echoed through the park, and for a moment, it felt as if the '
 'years melted away. The weight of their separate lives—filled with college, '
 'jobs, and new friendships—lifted, leaving only the essence of who they had '
 'been. As they shared stories of their lives since that fateful day, a blend '
 'of nostalgia and curiosity filled the air.\n'
 '\n'
 '“So, what’s the biggest change for you?” Emma asked, tilting her head '
 'slightly, a playful smile dancing on her lips.\n'
 '\n'
 'Jake hesitated for a moment, his expression shifting to one of reflection. '
 '“Honestly? I think it’s realizing how much I miss having a true friend. I’ve '
 'been so focused on work and moving forward that I forgot how much joy comes '
 'from just hanging out with someone who knows you inside and out.”\n'
 '\n'
 'Emma nodded, her heart swelling with warmth. “I feel the same way. After '
 'college, I got caught up in my art and lost touch with everyone. I thought I '
 'was happy, but it was like painting in a vacuum—there was no one to share it '
 'with.”\n'
 '\n'
 'As they spoke, the park around them transformed, the vibrant colors of '
 'autumn leaves mirroring the rekindling of their friendship. Each shared '
 'memory was a brushstroke, painting a picture of who they had once been and '
 'who they could become again.\n'
 '\n'
 '“Do you remember that camping trip we took with our parents?” Jake asked '
 'suddenly, a glimmer of mischief in his eyes. “You were convinced you could '
 'catch a fish with your bare hands.”\n'
 '\n'
 'Emma giggled, the memory flooding back. “And I ended up falling into the '
 'lake instead! I think I spent the rest of the trip shivering in my sleeping '
 'bag.”\n'
 '\n'
 '“Yeah, and we had to listen to your dad’s terrible campfire songs to keep us '
 'warm.”\n'
 '\n'
 'The laughter that followed was rich and hearty, a sound that felt like home. '
 'It was clear that their bond had weathered the storm of years apart. The '
 'awkwardness that often accompanies reconnections was absent; instead, it was '
 'as if they had simply paused the conversation and picked it up right where '
 'they left off.\n'
 '\n'
 'As the sun began to set, casting long shadows across the park, Emma looked '
 'at Jake, her expression serious for a moment. “I don’t want to lose this '
 'again, you know? Life has a way of pulling us in different directions.”\n'
 '\n'
 'Jake nodded, his gaze steady. “Neither do I. Let’s make a promise to meet '
 'here regularly. We can’t let the world get in the way of our friendship '
 'again.”\n'
 '\n'
 'A pact was formed in that moment, an unspoken understanding that they would '
 'do whatever it took to nurture this connection. They exchanged contact '
 'information, both eager to bridge the distance that had grown between them '
 'over the years.\n'
 '\n'
 'As they stood to leave, the park seemed to shimmer with possibility. It was '
 'more than just a gathering place; it was a new beginning, a canvas waiting '
 'to be filled with memories yet to come. Emma took a deep breath, the crisp '
 'air filling her lungs, and smiled at Jake, feeling a renewed sense of '
 'hope. \n'
 '\n'
 '“Until next time,” she said, her heart light.\n'
 '\n'
 '“Until next time,” Jake echoed, excitement bubbling beneath his calm '
 'exterior as they walked together, side by side, ready to face the world '
 'anew.\n'
 '\n'
 '\n'
 '== Chapter 3: Unexpected Reunion ==\n'
 '\n'
 'The following weeks felt like a dream to Emma. Each time she returned to '
 'Maplewood Park, the familiar sights and sounds wrapped around her like a '
 'warm blanket. The vibrant greens of the leaves, the laughter of children '
 'echoing in the distance, and the sweet scent of blooming flowers all '
 'reminded her of the happiness she had shared with Jake. It was as if time '
 'had folded in on itself, allowing them to reclaim a part of their lives that '
 'had been set aside for far too long.\n'
 '\n'
 'Their meetups became a ritual. They would stroll through the park, sharing '
 'stories about their lives since they had last seen each other. Jake spoke '
 'about his job at the local theater, his passion for acting igniting with '
 'every word. Emma found herself captivated, her heart swelling with pride for '
 'her friend. She shared her struggles as an artist, the challenges of finding '
 'her voice and the pressure to succeed. Jake listened intently, offering '
 'encouragement that felt like a lifeline.\n'
 '\n'
 'One sunny afternoon, as they sat on a bench overlooking the pond, Emma let '
 'her fingers dance over her sketchbook. She had begun to fill it with '
 'drawings inspired by their time together—each sketch a testament to the '
 'rekindled bond they were building. A quick glance at Jake revealed his eyes '
 'sparkling with interest, his curiosity piqued by the art that flowed from '
 'her heart. \n'
 '\n'
 '“What are you working on?” he asked, leaning closer. \n'
 '\n'
 'Emma hesitated, a wave of self-doubt washing over her. “Just some ideas… '
 'nothing special,” she replied, trying to downplay her efforts. \n'
 '\n'
 'Jake tilted his head, his expression earnest. “C’mon, show me. I want to see '
 'what you’ve been creating.” \n'
 '\n'
 'With a deep breath, Emma turned the sketchbook toward him. The first image '
 'was of the tree they had attempted to build their treehouse in all those '
 'years ago, its branches reaching toward the sky like an invitation to '
 'play. \n'
 '\n'
 'Jake chuckled, nostalgia brightening his face. “I can’t believe we thought '
 'we could actually build that thing. We were such dreamers.”\n'
 '\n'
 'Emma smiled, her heart fluttering at the sight of his amusement. “We still '
 'are, aren’t we?” \n'
 '\n'
 'The conversation flowed easily, punctuated by laughter and the occasional '
 'comfortable silence. But beneath the surface, Emma felt a tension building—a '
 'fear of losing this newfound connection. Memories of their past, woven with '
 'moments of laughter and tears, threatened to unravel at the seams of her '
 'heart. \n'
 '\n'
 'As they watched the sunset paint the sky in hues of orange and pink, Emma '
 'took a chance. “You know, I’ve missed this. Not just you, but… us. I didn’t '
 'realize how much I needed a friend like you in my life again.”\n'
 '\n'
 'Jake turned to her, his expression serious. “Me too. I thought those days '
 'were gone forever. But now, I can’t imagine not having you around.”\n'
 '\n'
 'The vulnerability in his voice struck a chord within her, and Emma nodded, '
 'her heart racing. “Let’s promise to keep doing this. No matter where life '
 'takes us. I don’t want to lose you again.”\n'
 '\n'
 'He reached for her hand, a simple gesture that spoke volumes. “I promise, '
 'Emma. We’ll make this work.” \n'
 '\n'
 'In that moment, as the sun dipped below the horizon, they sealed their pact '
 'with a shared glance that spoke of hope and renewed commitment. The years '
 'apart had been filled with silence, but now, in the glow of friendship '
 'reignited, they were ready to weave new stories together.\n'
 '\n'
 'As they walked back through the park, the sounds of the evening wrapped '
 'around them, a symphony of cicadas and rustling leaves. Emma felt lighter, '
 'as if the weight of the past had been lifted, replaced by the promise of a '
 'future filled with laughter, art, and companionship. \n'
 '\n'
 'And for the first time in years, she felt truly free.\n'
 '\n')
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  </body>
</html>